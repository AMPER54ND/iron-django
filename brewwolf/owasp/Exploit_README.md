# OWASP Top 10: Number 8: Insecure Deserialization Example

The following README contains a short walkthrough of the setup and exploit execution of an OWASP Top 10 vulnerability. This will allow you to conduct a localized remote code execution (RCE) attack exploiting a vulnerability in the implementation of Python Pickling on a Django web application.    

## Installation and setup of netcat listener
(Netcat is a computer networking utility for reading from and writing to network connections using TCP or UDP). This walkthrough assumes you have built and are currently running the tin-django server.

1. Make sure to install netcat from your distro repository. 
    ```
    sudo apt-get install netcat
    ```

1. Set up netcat listener on port 4444 to receive remote shell.
    ```
    nc -nvlp 4444
    ```
   
## Pickling the reverse shell command

1. From the tin-django directory, navigate to the payloads folder.
    ```
    cd brewwolf/owasp/payloads
    ```
    
1. Run the payload pickler    
    ```
    python3 payload.py
    ```

1. Copy the output. It should be a base64 encoded string.


## Starting the Tin-Django Server


1. Source your python virtual-environment    
    ```
    source venv/bin/activate
    ```

1. Update pip and install requirements
    ```
    pip install --upgrade pip
    (OPTIONAL) pip install django
    pip install -r requirements.txt
    ```

1. Collect the static files within the brewwolf project
    ```
    python manage.py collectstatic
    ```
    
1. Creating schema for database tables
    ```
    python manage.py makemigrations
    ```
    
1. Building Tables
    ```
    python manage.py migrate
    ```

1. Start the Server using the "manage.py" found within the brewwolf project
    ```
    python manage.py runserver
    ```
    
## Running the Exploit -- Must use Firefox for this example

1. Open your Firefox browser and navigate to `127.0.0.1:8000/owasp/messageboard`.
    
1. Open the developer consol and navigate to the networking tab.

1. Locate the 'GET' request for the /owasp/messageboard page. This may require you to reload the page. Right click the request and select 'Edit and Resend'. 

1. In the 'Headers' field, find the cookie labeled 'num_messages' and delete the current value, keeping the quotes. It should now look like `num_messages=""`

1. Paste the output from the payload pickler into the cookie field, and click 'Send'.

1. The new cookie with the pickled malicious payload will be sent to the server to be de-pickled. The de-pickling instuctions contained within the python object will instruct the server to send a bash shell to the 'remote' netcat listening address 127.0.0.1:4444. You should now see a shell appear in your terminal.
